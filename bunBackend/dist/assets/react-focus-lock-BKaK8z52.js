import{r as n}from"./react-DEdpUTZM.js";import{_ as H,c as We}from"./@babel-DzpKa8aK.js";import{F as ke,a as Oe,m as Y,f as Z,b as Ge,c as $e,d as Be,e as Me,g as ee,h as _e,i as He,j as Ne}from"./focus-lock-CAkr-jOZ.js";import{c as N,a as Te}from"./use-sidecar-BFrkB23O.js";import{u as De}from"./use-callback-ref-BH2RmtK3.js";import{w as Ue}from"./react-clientside-effect-fUghZiSs.js";var _={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},te=N({},function(r){var e=r.target,t=r.currentTarget;return{target:e,currentTarget:t}}),re=N(),je=N(),Ae=Te({async:!0,ssr:typeof document<"u"}),qe=n.createContext(void 0),Ve=[],T=n.forwardRef(function(e,t){var o,u=n.useState(),s=u[0],m=u[1],F=n.useRef(),h=n.useRef(!1),p=n.useRef(null),L=n.useState({}),S=L[1],c=e.children,b=e.disabled,d=b===void 0?!1:b,I=e.noFocusGuards,f=I===void 0?!1:I,E=e.persistentFocus,l=E===void 0?!1:E,i=e.crossFrame,y=i===void 0?!0:i,W=e.autoFocus,G=W===void 0?!0:W;e.allowTextSelection;var de=e.group,fe=e.className,le=e.whiteList,ve=e.hasPositiveIndices,A=e.shards,$=A===void 0?Ve:A,q=e.as,me=q===void 0?"div":q,V=e.lockProps,Fe=V===void 0?{}:V,be=e.sideCar,z=e.returnFocus,k=z===void 0?!1:z,he=e.focusOptions,B=e.onActivation,M=e.onDeactivation,pe=n.useState({}),ge=pe[0],Ee=n.useCallback(function(v){var C=v.captureFocusRestore;if(!p.current){var P,g=(P=document)==null?void 0:P.activeElement;p.current=g,g!==document.body&&(p.current=C(g))}F.current&&B&&B(F.current),h.current=!0,S()},[B]),ye=n.useCallback(function(){h.current=!1,M&&M(F.current),S()},[M]),Ce=n.useCallback(function(v){var C=p.current;if(C){var P=(typeof C=="function"?C():C)||document.body,g=typeof k=="function"?k(P):k;if(g){var K=typeof g=="object"?g:void 0;p.current=null,v?Promise.resolve().then(function(){return P.focus(K)}):P.focus(K)}}},[k]),Pe=n.useCallback(function(v){h.current&&te.useMedium(v)},[]),we=re.useMedium,xe=n.useCallback(function(v){F.current!==v&&(F.current=v,m(v))},[]),Le=H((o={},o[ke]=d&&"disabled",o[Oe]=de,o),Fe),J=f!==!0,Se=J&&f!=="tail",Re=De([t,xe]),Ie=n.useMemo(function(){return{observed:F,shards:$,enabled:!d,active:h.current}},[d,h.current,$,s]);return n.createElement(n.Fragment,null,J&&[n.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:d?-1:0,style:_}),ve?n.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:d?-1:1,style:_}):null],!d&&n.createElement(be,{id:ge,sideCar:Ae,observed:s,disabled:d,persistentFocus:l,crossFrame:y,autoFocus:G,whiteList:le,shards:$,onActivation:Ee,onDeactivation:ye,returnFocus:Ce,focusOptions:he,noFocusGuards:f}),n.createElement(me,H({ref:Re},Le,{className:fe,onBlur:we,onFocus:Pe}),n.createElement(qe.Provider,{value:Ie},c)),Se&&n.createElement("div",{"data-focus-guard":!0,tabIndex:d?-1:0,style:_}))});T.propTypes={};function D(r){setTimeout(r,1)}var ze=function(e){return e&&"current"in e?e.current:e},ne=function(){return document&&document.activeElement===document.body},Je=function(){return ne()||He()},w=null,a=null,Q=function(){return null},x=null,R=!1,U=!1,Ke=function(){return!0},Qe=function(e){return(w.whiteList||Ke)(e)},Xe=function(e,t){x={observerNode:e,portaledElement:t}},Ye=function(e){return x&&x.portaledElement===e};function X(r,e,t,o){var u=null,s=r;do{var m=o[s];if(m.guard)m.node.dataset.focusAutoGuard&&(u=m);else if(m.lockItem){if(s!==r)return;u=null}else break}while((s+=t)!==e);u&&(u.node.tabIndex=0)}var Ze=function(e){return e?!!R:R==="meanwhile"},et=function r(e,t,o){return t&&(t.host===e&&(!t.activeElement||o.contains(t.activeElement))||t.parentNode&&r(e,t.parentNode,o))},tt=function(e,t){return t.some(function(o){return et(e,o,o)})},oe=function(e){return Ne(e,new Map)},rt=function(e){return!oe([e.parentNode]).some(function(t){return t.node===e})},O=function(){var e=!1;if(w){var t=w,o=t.observed,u=t.persistentFocus,s=t.autoFocus,m=t.shards,F=t.crossFrame,h=t.focusOptions,p=t.noFocusGuards,L=o||x&&x.portaledElement;if(ne()&&a&&(!document.body.contains(a)||rt(a))){a=null;var S=Q();S&&S.focus()}var c=document&&document.activeElement;if(L){var b=[L].concat(m.map(ze).filter(Boolean)),d=function(){if(!Ze(F)||!p||!a||U)return!1;var i=oe(b),y=i.findIndex(function(W){var G=W.node;return G===a});return y===0||y===i.length-1};if((!c||Qe(c))&&(u||d()||!Je()||!a&&s)&&(L&&!(Z(b)||c&&tt(c,b)||Ye(c))&&(document&&!a&&c&&!s?(c.blur&&c.blur(),document.body.focus()):(e=Y(b,a,{focusOptions:h}),x={})),R=!1,a=document&&document.activeElement,Q=ee(a)),document&&c!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var I=document&&document.activeElement,f=_e(b),E=f.map(function(l){var i=l.node;return i}).indexOf(I);E>-1&&(f.filter(function(l){var i=l.guard,y=l.node;return i&&y.dataset.focusAutoGuard}).forEach(function(l){var i=l.node;return i.removeAttribute("tabIndex")}),X(E,f.length,1,f),X(E,-1,-1,f))}}}return e},ae=function(e){O()&&e&&(e.stopPropagation(),e.preventDefault())},j=function(){return D(O)},nt=function(e){var t=e.target,o=e.currentTarget;o.contains(t)||Xe(o,t)},ot=function(){return null},ue=function(){U=!0},se=function(){U=!1,R="just",D(function(){R="meanwhile"})},at=function(){document.addEventListener("focusin",ae),document.addEventListener("focusout",j),window.addEventListener("focus",ue),window.addEventListener("blur",se)},ut=function(){document.removeEventListener("focusin",ae),document.removeEventListener("focusout",j),window.removeEventListener("focus",ue),window.removeEventListener("blur",se)};function st(r){return r.filter(function(e){var t=e.disabled;return!t})}var ce={moveFocusInside:Y,focusInside:Z,focusNextElement:Ge,focusPrevElement:$e,focusFirstElement:Be,focusLastElement:Me,captureFocusRestore:ee};function ct(r){var e=r.slice(-1)[0];e&&!w&&at();var t=w,o=t&&e&&e.id===t.id;w=e,t&&!o&&(t.onDeactivation(),r.filter(function(u){var s=u.id;return s===t.id}).length||t.returnFocus(!e)),e?(a=null,(!o||t.observed!==e.observed)&&e.onActivation(ce),O(),D(O)):(ut(),a=null)}te.assignSyncMedium(nt);re.assignMedium(j);je.assignMedium(function(r){return r(ce)});const it=Ue(st,ct)(ot);var dt=n.forwardRef(function(e,t){return n.createElement(T,H({sideCar:it,ref:t},e))}),ie=T.propTypes||{};ie.sideCar;We(ie,["sideCar"]);dt.propTypes={};export{dt as F};
